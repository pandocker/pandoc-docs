# まえがき {-}

このドキュメントは、技術書典４にて発表した「私的Markdown-PDF変換環境を紹介する本３」の内容を
Windowsユーザ、特にMSWordと戦う必要がある皆さんに向けて再編集したものです。
Pandoc＋Docxの環境は他の方も研究しているのでN番煎じです。いままでこのシリーズでは
*さんざん忌避されてきた*MSWordあるいはDocxファイルですが、ついに手を出します。嫌だけど。

## 前提環境 {-}

この本では、Git、Docker及びOffice365のWordが動作するWindows10機[^company-machine]を対象にします。
半自動ローカルビルドについても言及するのでできればJerBrains系IDEが入っていると
いいと思います。文中ではPyCharmを例に使います。
今更いうほどでもないですがこの本もDockerイメージとCIを使って原稿リポジトリからコンパイルされました。
でも原稿編集はMacで行われました(なんでやねん)。

[^company-machine]: 筆者の会社支給のマシンはOS更新してもDockerとの相性問題が残るし突然の
シャットダウン現象が治らないしベンダーは遅延戦法で修理実行まで1ヶ月以上かかったしその割に
修理そのものは2時間しなかったしWindows嫌い

Dockerがちゃんと動かないWindows機をお使いの方は、WSLを有効にできるならWSL上に
スクラッチ構築[^refer-previous]すれば等価なものができます。そうでない方は*手元でのコンパイルを諦めて*
外部CIサービスを利用してください。

[^refer-previous]: 前作の「あえて環境を構築してみる編」を参照してください。

この本は、初のWindowsユーザ向け環境構築ガイド、Pandocのおさらい、テンプレート作成例、
ローカルビルド実行までを取り扱います。

# 地獄にようこそ

Docxファイル（以下単にDocx）ないしMSWord（以下単にWord）と戦うのは本当に骨が折れます。
そもそも戦うとか言ってる時点で敵視が垣間見えますが、Wordが意味不明な挙動をするので仕方がありません。

## 環境構築タイム

インストーラ実行祭りです。

### Git

Git for Windowsのインストーラをダウンロード・インストールしてください。

### Docker

Windows向けDockerはDocker for WindowsまたはDocker ***Toolbox*** for Windowsとして配布されています。Windows10の
バージョンによっていずれかをインストールしてください。**Toolbox**はVirtualBoxのインストールを必要とする代わりに
Home版でも使えます。Pro版ならDocker for Windowsを使います。*Hyper-Vを有効にする必要があります*。

今までのところWin10機で両方うまくいかない身近な例はありません。~でも筆者の会社PCはEnterprise版のくせにToolbox
を使ってます。~

### IDE(PyCharm)

**Git(VCS)コミット時に外部ツールを起動する機能がついたバージョン**が必要です。今までにPyCharmをインストール
したことがないなら何も考えずに最新版を入れるべきです。2018年版ならどのバージョンでもいいです。2017年版も
行けるかもしれませんが未テストです。

#### Markdown用プラグイン

Markdown Navigator

### フォント

Wordの日本語標準フォントが気に入らないので源ノ角ゴシック（日本語）に入れ替えます。

## PandocのDocx対応状況を確認しよう

この本はPandocを使うことを前提にしているので、PandocとDocx
何も考えずとりあえずDocxに出力するだけなら以下のコマンドでできます。

```bash
pandoc -t docx -o docx.docx markdown.md
```

出力ファイル`docx.docx`はデフォルトのスタイルを適用したものになります。デフォルトのスタイルが
どういうものかを確認するには
`pandoc --print-default-data-file reference.docx > template.docx`{.bash}で出力した`template.docx`
を参照します。このファイルを叩き台にして独自テンプレートにします([@sec:develop-template])。

# テンプレートのスタイルを決めよう {#sec:develop-template}

実はこの話題は別の方が研究中です。[参考書籍](#references)に列挙しておきます[^refer-doujinshi]。

[^refer-doujinshi]: 参考書籍類は大半が同人誌です。狭い世界ですね。

## デフォルトテンプレートに採用されているスタイル

* Title / 表題
* Subtitle / 副題
* Author
* Date / 日付
* Abstract
* Header1〜9 / 見出し1〜9
* First Paragraph
* Body Text / 本文
    * Body Text Char
* Verbatim Char
* Hyperlink / ハイパーリンク
* 脚注参照
* 脚注文字列
* Block Text / ブロック
* Compact
* Definition
* Definition Term
* Figure
* Image Caption
* Table Caption

## 大方針：デフォルトから大きく変化させない

テンプレートファイルの変更は無制限に行うことができますが、それらの変更の継承具合（全て正しく適用されて出力されるか）
はわかりません。一方でデフォルトファイルのスタイルや情報は基本的に継承されるということです。したがって
デフォルト設定を大きく逸脱させないテンプレートにします。

### 共通フォント設定

ほとんどのスタイルは「基準にするスタイル」と「次の段落のスタイル」を利用したツリー構造になっています。
親スタイルの変更は子スタイルに反映されます。デフォルトでは"標準"と"本文"と"図表番号"がツリーの上位にいるので
これらをまとめて変更します。

日本語と英数字でフォントを切り分けるようになっているので源ノ角ゴシックを日本語用に、Source Code Proを英数字用に
設定します。フォントサイズは変更なし、下の方のチェックマークは全てオンにします。

### ページ余白
### ヘッダ・フッタ
### 番号つき見出しにする・番号なし見出しを追加する・レベル1見出しの前は改ページさせる
### コードブロック用スタイルを追加する
### その他オレオレスタイルを用意する

# 原稿を書こう（本題）
## 任意のスタイルを適用させるPandocコマンドを利用する

# 参考書籍 {- #references}

* "2010-2016ユーザーに向けたWORDと文書のレイアウト - 文字の配置・段落設定から図・罫線表の利用まで-", 2017.12(C93), URT. Lab
* "PyCharm のすすめ \\~デプロイとデバッグ編\\~ 珍獣 著 2018-10-08 版", 2017.10（技術書典5）


# 更新履歴 {-}

## Revision4.0（C95） {-}

![原稿PDFへのリンク](images/QRcode.png){#img:manuscript width=30%}
